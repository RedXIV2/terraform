---
- hosts: all
  vars:
    download_url: https://download.java.net/java/GA/jdk10/10.0.1/fb4372174a714e6b8c52526dc134031e/10/openjdk-10.0.1_linux-x64_bin.tar.gz
    download_folder: /opt
    java_name: "{{download_folder}}/jdk-10.0.1"
    java_archive: "{{download_folder}}/openjdk-10.0.1-linux-x64_bin.tar.gz"
  tasks:

    - name: Create the Directory Structure
      file:
        path: /opt/oracle
        state: directory
        owner: ubuntu
        group: ubuntu
        mode: 0755
      become: true

    - name: Create the Directory Structure
      file:
        path: /opt/oracle/jdk1.8.0_131
        state: directory
        owner: ubuntu
        group: ubuntu
        mode: 0755
      become: true

    - name: Download Java
      get_url: url={{ download_url }} dest={{ java_archive }} headers="Cookie:' gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie'" validate_certs=no owner=root group=root mode=744
      become: true

    - name: Unpack archive
      unarchive: copy=no src={{ java_archive }} dest={{download_folder}}
      become: true

    - name: Fix ownership
      file: state=directory path={{java_name}} owner=root group=root recurse=yes
      become: true

    - name: Make Java available for system by updating alternatives
      command: alternatives --install /usr/bin/java java {{ java_name }}/bin/java 2000
      become: true

    - name: Make Jar available for system by updating alternatives
      command: alternatives --install /usr/bin/jar jar {{ java_name }}/bin/jar 2
      become: true

    - name: Make Javac available for system by updating alternatives
      command: alternatives --install /usr/bin/javac javac {{ java_name }}/bin/javac 2
      become: true

    - name: Make Jar available for system by updating alternatives
      command: alternatives --set jar {{ java_name }}/bin/jar
      become: true

    - name: Make Javac available for system by updating alternatives
      command: alternatives --set javac {{ java_name }}/bin/javac
      become: true

    - name: Set systemwide oracle env file under /etc/profile.d/
      set_fact: remote_file_path={{profile_path}}/oracle_jdk.sh

